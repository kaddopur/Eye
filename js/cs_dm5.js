// Generated by CoffeeScript 1.4.0
var checkPath, setImage, urlSort;

checkPath = function() {
  var cid, cursor, i, imageList, max, re_cid, re_path, _i, _results;
  re_path = /\/m\d*.*/gi;
  re_cid = /m(\d*)/;
  if (window.location.pathname.match(re_path) === null) {
    return;
  }
  console.log('loading OK');
  cid = parseInt(window.location.pathname.match(re_cid)[1]);
  max = $('select option').length;
  imageList = [];
  cursor = 1;
  _results = [];
  for (i = _i = 1; 1 <= max ? _i <= max : _i >= max; i = 1 <= max ? ++_i : --_i) {
    _results.push($.get('http://tel.dm5.com/chapterimagefun.ashx', {
      cid: cid,
      page: i,
      key: $('#dm5_key').val(),
      language: 1
    }, function(res) {
      eval(res);
      imageList.push(d[0]);
      if (imageList.length >= max) {
        imageList.sort(urlSort);
        return setImage(imageList);
      }
    }));
  }
  return _results;
};

urlSort = function(a, b) {
  var aIndex, bIndex, re_page;
  re_page = /\/(\d*)_/;
  aIndex = parseInt(a.match(re_page)[1]);
  bIndex = parseInt(b.match(re_page)[1]);
  return aIndex - bIndex;
};

setImage = function(imageList) {
  var url, _i, _len;
  $('body').html('');
  $('body').css('background-image', 'none');
  for (_i = 0, _len = imageList.length; _i < _len; _i++) {
    url = imageList[_i];
    $('body').append("	  <div class='eox-page'>		<img src=" + url + ">	  </div>");
  }
  return $('.eox-page').css('width', window.innerWidth - 120);
};

checkPath();
