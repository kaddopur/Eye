<html>
<head>
  <!-- ver 1.4.7 -->
  <script>
    function showIcon(tab) {
      if (keepGoing(tab.url) != -1 &&
        tab.url != '' &&
        tab.url.search('result.html') == -1) {
        chrome.tabs.update(tab.id, {'url': 'result.html?url=' + tab.url});
      } else {
        chrome.pageAction.hide(tab.id);
      }
    }
    
    function keepGoing(targetUrl){
      var req;
      req = new XMLHttpRequest();
      req.open("GET", targetUrl, false);
      req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
              
      var encoded = "";
      req.send(encoded);
              
      var response = req.responseText;
      return response.search('PicListUrl');
    }

    chrome.tabs.onSelectionChanged.addListener(function(tabId) {
      chrome.tabs.get(tabId, showIcon);
    });
    
    chrome.tabs.getSelected(null, showIcon);
    
    chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
      showIcon(tab);
    });
    
  </script>
</head>

<body>
<canvas id="canvas" width="19" height="19"></canvas>
</body>
</html>
